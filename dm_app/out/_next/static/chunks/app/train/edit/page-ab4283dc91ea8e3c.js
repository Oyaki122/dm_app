(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[213],{4115:function(e,n,i){Promise.resolve().then(i.bind(i,627))},6327:function(e,n,i){"use strict";i.d(n,{A7:function(){return c},EO:function(){return p},JE:function(){return m}});var t=i(9268),r=i(1822),l=i(6840),a=i(6720),s=i(4873),u=i(728),o=i(3862),d=i(157);function c(e){let{element:n}=e;return(0,t.jsx)(r.Tr,{children:n.map((e,n)=>(0,t.jsx)(l.Td,{children:e},n))})}function p(e){let{element:n}=e;return(0,t.jsx)(r.Tr,{children:n.map((e,n)=>(0,t.jsx)(l.Td,{children:e},n))})}function m(e){let{indexes:n,children:i}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(a.x,{children:(0,t.jsxs)(s.i,{variant:"simple",colorScheme:"gray",children:[(0,t.jsx)(u.h,{children:(0,t.jsx)(r.Tr,{children:n.map((e,n)=>(0,t.jsx)(o.Th,{children:e},n))})}),(0,t.jsx)(d.p,{children:i})]})})})}i(6006)},9360:function(e,n,i){"use strict";i.d(n,{_:function(){return t}});let t=e=>async(n,i)=>{let t={};t=void 0===i?{credentials:"include"}:{...i,credentials:"include"};let r=await fetch(n,t),l=await r.json();return e.parse(l)}},6196:function(e,n,i){"use strict";i.d(n,{x:function(){return r}});var t=i(2391);let r=t.z.object({range:t.z.array(t.z.object({train_id:t.z.number(),conductor_id:t.z.number(),driver_id:t.z.number(),station_id:t.z.number()}))})},4194:function(e,n,i){"use strict";i.d(n,{H:function(){return r}});var t=i(2391);let r=t.z.object({drivers:t.z.array(t.z.object({driver_id:t.z.number().positive().int(),name:t.z.string(),affilitation:t.z.string()}))})},2503:function(e,n,i){"use strict";i.d(n,{y:function(){return r}});var t=i(2391);let r=t.z.object({stations:t.z.array(t.z.object({station_id:t.z.number().positive().int(),name:t.z.string(),city:t.z.string(),line:t.z.string()}))})},4948:function(e,n,i){"use strict";i.d(n,{s:function(){return l}});var t=i(2391);let r=t.z.custom(e=>{if("number"!=typeof e)return!1;let n=e/100,i=e%100;return!(n<0)&&!(n>24)&&!(i<0)&&!(i>59)}),l=t.z.object({stops:t.z.array(t.z.object({train_id:t.z.number(),station_id:t.z.number(),arrival_time:r.nullish(),departure_time:r.nullish()}))})},8301:function(e,n,i){"use strict";i.d(n,{v:function(){return r}});var t=i(2391);let r=t.z.object({train:t.z.object({train_id:t.z.number(),origin:t.z.number(),destinaion:t.z.number(),car:t.z.number()})})},627:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return O}});var t=i(9268),r=i(8301),l=i(2503),a=i(6196),s=i(4194),u=i(4948),o=i(5846),d=i.n(o),c=i(5559),p=i(8823),m=i(1060),v=i(5134),h=i(2386),f=i(7932),x=i(6185),_=i(673),j=i(2127),b=i(160),g=i(2344),y=i(4658),z=i(2261),N=i(7400),k=i(1283),I=i(9745),C=i(9360),S=i(730),P=i(6327),F=i(6006),T=i(6008);function O(){var e,n,i,o,O,w,E;let q=(0,T.useRouter)(),R={slug:""};R.slug=null!==(e=new URLSearchParams(new URL(window.location.href).search).get("slug"))&&void 0!==e?e:"";let{data:L,error:B}=(0,S.ZP)("http://user.keio.ac.jp/~ub622319/dm_app2/api/train_detail/"+R.slug,(0,C._)(r.v)),{data:G,error:J}=(0,S.ZP)("http://user.keio.ac.jp/~ub622319/dm_app2/api/get_stations",(0,C._)(l.y)),H=null==G?void 0:G.stations,{data:D,error:Z}=(0,S.ZP)("http://user.keio.ac.jp/~ub622319/dm_app2/api/get_drivers",(0,C._)(s.H)),Q=null==D?void 0:D.drivers,{data:Y,error:$}=(0,S.ZP)("http://user.keio.ac.jp/~ub622319/dm_app2/api/crewRange/".concat(null==L?void 0:L.train.train_id),(0,C._)(a.x)),{data:A,error:U}=(0,S.ZP)("http://user.keio.ac.jp/~ub622319/dm_app2/api/stops/".concat(null==L?void 0:L.train.train_id),(0,C._)(u.s)),[M,X]=(0,F.useState)(null!==(n=null==L?void 0:L.train.origin)&&void 0!==n?n:0),[K,V]=(0,F.useState)(null!==(i=null==L?void 0:L.train.destinaion)&&void 0!==i?i:0);(0,F.useEffect)(()=>{var e,n;X(null!==(e=null==L?void 0:L.train.origin)&&void 0!==e?e:0),V(null!==(n=null==L?void 0:L.train.destinaion)&&void 0!==n?n:0)},[L]),console.log(B,J,Z,$,U);let[W,ee]=(0,F.useState)(null!==(o=null==Y?void 0:Y.range)&&void 0!==o?o:[]);(0,F.useEffect)(()=>{var e;ee(null!==(e=null==Y?void 0:Y.range)&&void 0!==e?e:[])},[Y]);let[en,ei]=(0,F.useState)(null!==(O=null==A?void 0:A.stops.sort((e,n)=>{var i,t;return null===e.departure_time&&null===n.departure_time?0:null===e.departure_time?1:null===n.departure_time?-1:(null!==(i=e.departure_time)&&void 0!==i?i:0)-(null!==(t=n.departure_time)&&void 0!==t?t:0)}))&&void 0!==O?O:[]);(0,F.useEffect)(()=>{var e;ei(null!==(e=null==A?void 0:A.stops.sort((e,n)=>{var i,t;return null===e.departure_time&&null===n.departure_time?0:null===e.departure_time?1:null===n.departure_time?-1:(null!==(i=e.departure_time)&&void 0!==i?i:0)-(null!==(t=n.departure_time)&&void 0!==t?t:0)}))&&void 0!==e?e:[])},[A]);let et=async()=>{let e=fetch("http://user.keio.ac.jp/~ub622319/dm_app2/api/crewRange/".concat(null==L?void 0:L.train.train_id,"/edit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:W})}),n=fetch("http://user.keio.ac.jp/~ub622319/dm_app2/api/stops/".concat(null==L?void 0:L.train.train_id,"/edit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({record:en})}),i=fetch("http://user.keio.ac.jp/~ub622319/dm_app2/api/train_detail/".concat(null==L?void 0:L.train.train_id,"/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...null==L?void 0:L.train,origin:M,destination:K})});await Promise.all([e,n,i]),q.push("/train/detail?slug=".concat(null==L?void 0:L.train.train_id))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.X,{as:"h2",size:"lg",children:"列車管理 編集"}),(0,t.jsxs)(p.U,{p:"1rem",spacing:"1rem",children:[(0,t.jsx)(m.xu,{p:"1rem",children:(0,t.jsxs)(c.X,{as:"h3",size:"md",children:["列車番号: ",null==L?void 0:L.train.train_id]})}),(0,t.jsxs)(v.k,{p:"1rem",children:[(0,t.jsxs)(h.NI,{children:[(0,t.jsx)(f.l,{children:"出発"}),(0,t.jsx)(x.P,{value:M,onChange:e=>X(parseInt(e.target.value,10)),children:null==H?void 0:H.map((e,n)=>(0,t.jsx)("option",{value:e.station_id,children:e.name},n))})]}),(0,t.jsxs)(h.NI,{children:[(0,t.jsx)(f.l,{children:"到着"}),(0,t.jsx)(x.P,{value:K,onChange:e=>V(parseInt(e.target.value,10)),children:null==H?void 0:H.map((e,n)=>(0,t.jsx)("option",{value:e.station_id,children:e.name},n))})]})]}),(0,t.jsx)(_.L,{}),(0,t.jsxs)(v.k,{children:[(0,t.jsx)(d(),{href:"/train/detail/?slug=".concat(null==L?void 0:L.train.train_id),children:(0,t.jsx)(j.z,{colorScheme:"red",children:"キャンセル"})}),(0,t.jsx)(j.z,{colorScheme:"blue",onClick:et,children:"更新"})]})]}),(0,t.jsx)(m.xu,{p:"1rem",children:(0,t.jsxs)(b.m,{children:[(0,t.jsxs)(g.t,{children:[(0,t.jsx)(y.O,{children:"停車駅"}),(0,t.jsx)(y.O,{children:"乗務員"})]}),(0,t.jsxs)(z.n,{children:[(0,t.jsx)(N.x,{children:(0,t.jsx)(P.JE,{indexes:["駅","到着時間","出発時間"],children:null==en?void 0:en.map((e,n)=>{var i;return(0,t.jsx)(P.EO,{element:[(0,t.jsx)(k.x,{children:null==H?void 0:null===(i=H.find(n=>n.station_id===e.station_id))||void 0===i?void 0:i.name},n),(0,t.jsx)(h.NI,{children:(0,t.jsx)(I.I,{type:"number",value:null!==(w=e.arrival_time)&&void 0!==w?w:"",onChange:e=>(en[n].arrival_time=parseInt(e.target.value,10),ei([...en]))})},n),(0,t.jsx)(h.NI,{children:(0,t.jsx)(I.I,{type:"number",value:null!==(E=e.departure_time)&&void 0!==E?E:"",onChange:e=>(en[n].departure_time=""===e.target.value?null:parseInt(e.target.value,10),ei([...en]))})},n)]},n)})})}),(0,t.jsx)(N.x,{children:(0,t.jsx)(P.JE,{indexes:["駅","運転手"],children:null==W?void 0:W.map((e,n)=>{var i;return(0,t.jsx)(P.EO,{element:[(0,t.jsx)(k.x,{children:null==H?void 0:null===(i=H.find(n=>n.station_id===e.station_id))||void 0===i?void 0:i.name},n),(0,t.jsx)(h.NI,{children:(0,t.jsx)(x.P,{value:e.driver_id,onChange:e=>(W[n].driver_id=parseInt(e.target.value,10),ee([...W])),children:null==Q?void 0:Q.map((e,n)=>(0,t.jsx)("option",{value:e.driver_id,children:e.name},n))})},n)]},n)})})})]})]})})]})}},6008:function(e,n,i){e.exports=i(8170)},7932:function(e,n,i){"use strict";i.d(n,{l:function(){return d},n:function(){return c}});var t=i(2386),r=i(8710),l=i(5526),a=i(2424),s=i(2088),u=i(463),o=i(9268),d=(0,r.G)(function(e,n){var i;let r=(0,l.mq)("FormLabel",e),d=(0,a.Lr)(e),{className:p,children:m,requiredIndicator:v=(0,o.jsx)(c,{}),optionalIndicator:h=null,...f}=d,x=(0,t.NJ)(),_=null!=(i=null==x?void 0:x.getLabelProps(f,n))?i:{ref:n,...f};return(0,o.jsxs)(s.m.label,{..._,className:(0,u.cx)("chakra-form__label",d.className),__css:{display:"block",textAlign:"start",...r},children:[m,(null==x?void 0:x.isRequired)?v:h]})});d.displayName="FormLabel";var c=(0,r.G)(function(e,n){let i=(0,t.NJ)(),r=(0,t.e)();if(!(null==i?void 0:i.isRequired))return null;let l=(0,u.cx)("chakra-form__required-indicator",e.className);return(0,o.jsx)(s.m.span,{...null==i?void 0:i.getRequiredIndicatorProps(e,n),__css:r.requiredIndicator,className:l})});c.displayName="RequiredIndicator"},2386:function(e,n,i){"use strict";i.d(n,{NI:function(){return f},NJ:function(){return h},Q6:function(){return x},e:function(){return m}});var t=i(2027),r=i(4966),l=i(8710),a=i(5526),s=i(2424),u=i(2088),o=i(463),d=i(6006),c=i(9268),[p,m]=(0,t.k)({name:"FormControlStylesContext",errorMessage:"useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<FormControl />\" "}),[v,h]=(0,t.k)({strict:!1,name:"FormControlContext"}),f=(0,l.G)(function(e,n){let i=(0,a.jC)("Form",e),t=(0,s.Lr)(e),{getRootProps:l,htmlProps:m,...h}=function(e){let{id:n,isRequired:i,isInvalid:t,isDisabled:l,isReadOnly:a,...s}=e,u=(0,d.useId)(),c=n||`field-${u}`,p=`${c}-label`,m=`${c}-feedback`,v=`${c}-helptext`,[h,f]=(0,d.useState)(!1),[x,_]=(0,d.useState)(!1),[j,b]=(0,d.useState)(!1),g=(0,d.useCallback)((e={},n=null)=>({id:v,...e,ref:(0,r.lq)(n,e=>{e&&_(!0)})}),[v]),y=(0,d.useCallback)((e={},n=null)=>({...e,ref:n,"data-focus":(0,o.PB)(j),"data-disabled":(0,o.PB)(l),"data-invalid":(0,o.PB)(t),"data-readonly":(0,o.PB)(a),id:void 0!==e.id?e.id:p,htmlFor:void 0!==e.htmlFor?e.htmlFor:c}),[c,l,j,t,a,p]),z=(0,d.useCallback)((e={},n=null)=>({id:m,...e,ref:(0,r.lq)(n,e=>{e&&f(!0)}),"aria-live":"polite"}),[m]),N=(0,d.useCallback)((e={},n=null)=>({...e,...s,ref:n,role:"group"}),[s]),k=(0,d.useCallback)((e={},n=null)=>({...e,ref:n,role:"presentation","aria-hidden":!0,children:e.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!t,isReadOnly:!!a,isDisabled:!!l,isFocused:!!j,onFocus:()=>b(!0),onBlur:()=>b(!1),hasFeedbackText:h,setHasFeedbackText:f,hasHelpText:x,setHasHelpText:_,id:c,labelId:p,feedbackId:m,helpTextId:v,htmlProps:s,getHelpTextProps:g,getErrorMessageProps:z,getRootProps:N,getLabelProps:y,getRequiredIndicatorProps:k}}(t),f=(0,o.cx)("chakra-form-control",e.className);return(0,c.jsx)(v,{value:h,children:(0,c.jsx)(p,{value:i,children:(0,c.jsx)(u.m.div,{...l({},n),className:f,__css:i.container})})})});f.displayName="FormControl";var x=(0,l.G)(function(e,n){let i=h(),t=m(),r=(0,o.cx)("chakra-form__helper-text",e.className);return(0,c.jsx)(u.m.div,{...null==i?void 0:i.getHelpTextProps(e,n),__css:t.helperText,className:r})});x.displayName="FormHelperText"},7106:function(e,n,i){"use strict";i.d(n,{K:function(){return a},Y:function(){return l}});var t=i(2386),r=i(463);function l(e){let{isDisabled:n,isInvalid:i,isReadOnly:t,isRequired:l,...s}=a(e);return{...s,disabled:n,readOnly:t,required:l,"aria-invalid":(0,r.Qm)(i),"aria-required":(0,r.Qm)(l),"aria-readonly":(0,r.Qm)(t)}}function a(e){var n,i,l;let a=(0,t.NJ)(),{id:s,disabled:u,readOnly:o,required:d,isRequired:c,isInvalid:p,isReadOnly:m,isDisabled:v,onFocus:h,onBlur:f,...x}=e,_=e["aria-describedby"]?[e["aria-describedby"]]:[];return(null==a?void 0:a.hasFeedbackText)&&(null==a?void 0:a.isInvalid)&&_.push(a.feedbackId),(null==a?void 0:a.hasHelpText)&&_.push(a.helpTextId),{...x,"aria-describedby":_.join(" ")||void 0,id:null!=s?s:null==a?void 0:a.id,isDisabled:null!=(n=null!=u?u:v)?n:null==a?void 0:a.isDisabled,isReadOnly:null!=(i=null!=o?o:m)?i:null==a?void 0:a.isReadOnly,isRequired:null!=(l=null!=d?d:c)?l:null==a?void 0:a.isRequired,isInvalid:null!=p?p:null==a?void 0:a.isInvalid,onFocus:(0,r.v0)(null==a?void 0:a.onFocus,h),onBlur:(0,r.v0)(null==a?void 0:a.onBlur,f)}}},9745:function(e,n,i){"use strict";i.d(n,{I:function(){return d}});var t=i(7106),r=i(8710),l=i(5526),a=i(2424),s=i(2088),u=i(463),o=i(9268),d=(0,r.G)(function(e,n){let{htmlSize:i,...r}=e,d=(0,l.jC)("Input",r),c=(0,a.Lr)(r),p=(0,t.Y)(c),m=(0,u.cx)("chakra-input",e.className);return(0,o.jsx)(s.m.input,{size:i,...p,__css:d.field,ref:n,className:m})});d.displayName="Input",d.id="Input"},1283:function(e,n,i){"use strict";i.d(n,{x:function(){return d}});var t=i(8710),r=i(5526),l=i(2424),a=i(2088),s=i(463),u=i(7873),o=i(9268),d=(0,t.G)(function(e,n){let i=(0,r.mq)("Text",e),{className:t,align:d,decoration:c,casing:p,...m}=(0,l.Lr)(e),v=(0,u.o)({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return(0,o.jsx)(a.m.p,{ref:n,className:(0,s.cx)("chakra-text",e.className),...v,...m,__css:i})});d.displayName="Text"},5134:function(e,n,i){"use strict";i.d(n,{k:function(){return a}});var t=i(8710),r=i(2088),l=i(9268),a=(0,t.G)(function(e,n){let{direction:i,align:t,justify:a,wrap:s,basis:u,grow:o,shrink:d,...c}=e;return(0,l.jsx)(r.m.div,{ref:n,__css:{display:"flex",flexDirection:i,alignItems:t,justifyContent:a,flexWrap:s,flexBasis:u,flexGrow:o,flexShrink:d},...c})});a.displayName="Flex"},7873:function(e,n,i){"use strict";function t(e){let n=Object.assign({},e);for(let e in n)void 0===n[e]&&delete n[e];return n}i.d(n,{o:function(){return t}})},6185:function(e,n,i){"use strict";i.d(n,{P:function(){return p}});var t=i(1373),r=i(7106),l=i(8710),a=i(5526),s=i(2424),u=i(2088),o=i(463),d=i(6006),c=i(9268),p=(0,l.G)((e,n)=>{var i;let l=(0,a.jC)("Select",e),{rootProps:d,placeholder:p,icon:m,color:v,height:f,h:x,minH:_,minHeight:j,iconColor:b,iconSize:g,...y}=(0,s.Lr)(e),[z,N]=function(e,n){let i={},t={};for(let[r,l]of Object.entries(e))n.includes(r)?i[r]=l:t[r]=l;return[i,t]}(y,s.oE),k=(0,r.Y)(N),I={paddingEnd:"2rem",...l.field,_focus:{zIndex:"unset",...null==(i=l.field)?void 0:i._focus}};return(0,c.jsxs)(u.m.div,{className:"chakra-select__wrapper",__css:{width:"100%",height:"fit-content",position:"relative",color:v},...z,...d,children:[(0,c.jsx)(t.m,{ref:n,height:null!=x?x:f,minH:null!=_?_:j,placeholder:p,...k,__css:I,children:e.children}),(0,c.jsx)(h,{"data-disabled":(0,o.PB)(k.disabled),...(b||v)&&{color:b||v},__css:l.icon,...g&&{fontSize:g},children:m})]})});p.displayName="Select";var m=e=>(0,c.jsx)("svg",{viewBox:"0 0 24 24",...e,children:(0,c.jsx)("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),v=(0,u.m)("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),h=e=>{let{children:n=(0,c.jsx)(m,{}),...i}=e,t=(0,d.cloneElement)(n,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return(0,c.jsx)(v,{...i,className:"chakra-select__icon-wrapper",children:(0,d.isValidElement)(n)?t:null})};h.displayName="SelectIcon"},1373:function(e,n,i){"use strict";i.d(n,{m:function(){return s}});var t=i(463),r=i(8710),l=i(2088),a=i(9268),s=(0,r.G)(function(e,n){let{children:i,placeholder:r,className:s,...u}=e;return(0,a.jsxs)(l.m.select,{...u,ref:n,className:(0,t.cx)("chakra-select",s),children:[r&&(0,a.jsx)("option",{value:"",children:r}),i]})});s.displayName="SelectField"}},function(e){e.O(0,[559,845,782,787,253,961,744],function(){return e(e.s=4115)}),_N_E=e.O()}]);